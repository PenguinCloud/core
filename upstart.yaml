---
- name: Install Ansible Host Baseline
  hosts: all
  become: yes
  become_user: root
  remote_user: root
  roles:
    - kwoodson.yedit
  vars_files:
    - vars/system.yaml
  tasks:
    - name: Disable problematic unattended Upgrades
      include_tasks:
        file: jobs/install/unattended.yaml
        apply:
          tags:
            - enviro
      tags:
        - enviro
      when: runmode == "standard"
    - name: Setup DNS
      include_tasks:
        file: jobs/configure/dns.yaml
        apply:
          tags:
            - enviro
            - dns
            - first
      tags:
        - enviro
        - dns
        - first
    - name: Update and get container to standard point
      include_tasks: 
        file: jobs/run/system.yaml
        apply:
          tags:
            - enviro
            - system
      tags:
        - enviro
    - name: Setup twice daily updates
      include_tasks:
        file: jobs/install/autoupdate.yaml
        apply:
          tags:
            - enviro
            - first
      tags:
        - enviro
        - first
    - name: Setup local interface
      include_tasks:
        file: jobs/configure/local_interface.yaml
        apply:
          tags:
            - enviro
            - interface
            - first
      tags:
        - enviro
        - interface
        - first
      when: not runmode == "docker"
    - name: Make sure DNS is still setup correctly.
      include_tasks:
        file: jobs/configure/dns.yaml
        apply:
          tags:
            - enviro
            - dns
            - first
      tags:
        - enviro
        - dns
        - first
    - name: Configure System
      include_tasks:
        file: jobs/configure/system.yaml
        apply:
          tags:
            - enviro
            - system
            - first
      tags:
        - enviro
        - system
        - first